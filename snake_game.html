<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´ªåƒè›‡å¤§ä½œæˆ˜_é›·åŒº_ç©å•æœºæ¥é›·åŒº</title>
    <meta name="keywords"
        content="è´ªåƒè›‡å¤§ä½œæˆ˜,è´ªåƒè›‡æ¸¸æˆ,è´ªåƒè›‡åœ¨çº¿ç©,è´ªåƒè›‡å¤§åšæˆ˜,è›‡è›‡å¤§ä½œæˆ˜,slither.io,è´ªåƒè›‡å¤§æˆ˜,è´ªåƒè›‡3d,è´ªåƒè›‡2,è´ªåƒè›‡97,ç»å…¸è´ªåƒè›‡,é›·åŒº,å•æœºæ¸¸æˆ,é›·åŒºå•æœºæ¸¸æˆ">
    <meta name="description" content="è´ªåƒè›‡ï¼Œè´ªåƒè›‡å¤§ä½œæˆ˜æ˜¯ä¸€æ¬¾è¶…å¥½ç©çš„ä¼‘é—²æ¸¸æˆï¼Œä¸ä»…æ¯”æ‹¼æ‰‹é€Ÿï¼Œæ›´è€ƒéªŒä½ çš„ååº”ï¼åœ¨è´ªåƒè›‡å¤§ä½œæˆ˜çš„ä¸–ç•Œä¸­ï¼Œä½ åŒ–èº«ä¸ºä¸€æ¡å°è›‡ï¼Œé€šè¿‡ä¸æ–­åŠªåŠ›å˜å¾—è¶Šæ¥è¶Šé•¿ï¼Œæœ€ç»ˆç»Ÿæ²»æ•´ä¸ªä¸–ç•Œï¼">

    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
            background-image: url('https://img.xunzhijishu.com/img/view/id/609879/sz/540');
            background-repeat: repeat;
            background-size: auto;
            height: 100vh;
            margin: 0;
            padding: 20px;
            overflow: hidden;
        }

        #gameCanvas {
            border: 2px solid #333;
            background-color: #fff;
            position: relative;
        }

        .score-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        .score {
            width: 180px;
            font-size: 24px;
        }

        #startButton {
            width: 120px;
            height: 40px;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #startButton:hover {
            background-color: #45a049;
        }

        #soundToggle {
            width: 120px;
            height: 40px;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #soundToggle:hover {
            background-color: #45a049;
        }

        #soundToggle.off {
            background-color: #f44336;
        }

        #soundToggle.off:hover {
            background-color: #d32f2f;
        }

        .button-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
        }

        #pauseOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .canvas-container {
            position: relative;
        }

        .controls-info {
            margin-top: 20px;
            text-align: center;
            color: #666;
        }

        .sound-toggle {
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .sound-toggle button {
            width: 120px;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .sound-toggle button:hover {
            background-color: #45a049;
        }

        .sound-toggle button.off {
            background-color: #f44336;
        }

        .sound-toggle button.off:hover {
            background-color: #d32f2f;
        }
    </style>
</head>

<body>
    <h1>è´ªåƒè›‡å¤§ä½œæˆ˜</h1>
    <div class="score-container">
        <div id="currentScore" class="score">å½“å‰åˆ†æ•°: 0</div>
        <div id="highScore" class="score" style="width: auto;">æœ€é«˜åˆ†æ•°: 0</div>
    </div>
    <div class="canvas-container">
        <!-- å› ä¸ºå®½åº¦æ¯ä¸€ä¸ªå—çš„å®½åº¦ä½¿ç”¨äº†gridSize - 4ï¼Œæ‰€ä»¥å®½åº¦æ˜¯396 -->
        <canvas id="gameCanvas" width="396" height="396"></canvas>
        <div id="pauseOverlay">æ¸¸æˆå·²æš‚åœ</div>
    </div>
    <div class="button-container">
        <button id="startButton">å¼€å§‹æ¸¸æˆ</button>
        <button id="soundToggle" class="on">éŸ³æ•ˆ: å¼€</button>
    </div>
    <div class="controls-info">
        <p>ç‚¹å‡»å¼€å§‹æ¸¸æˆï¼ŒæŒ‰ä»»æ„æ–¹å‘é”®å¼€å§‹ç§»åŠ¨</p>
        <p>æ–¹å‘é”®æˆ–WASDæ§åˆ¶æ–¹å‘ | ç©ºæ ¼é”®æš‚åœ/ç»§ç»­</p>
    </div>

    <!-- æ·»åŠ éŸ³æ•ˆæ–‡ä»¶ -->

    <audio id="eatSound" src="https://video.xunzhijishu.com/xl-zgamer-video/ad/27/1192-6185-44a8-a5e9-67c114396288"
        preload="auto"></audio>
    <audio id="gameOverSound" src="https://video.xunzhijishu.com/xl-zgamer-video/f9/df/f23c-6dd8-49c7-8094-4d5804ed2385"
        preload="auto"></audio>


    <script>

        var isDebug = true

        async function fetchData(url, data) {
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Access-Control-Allow-Origin': '*',
                        'Access-Control-Allow-Methods': 'POST, OPTIONS',
                        'Access-Control-Allow-Headers': 'Content-Type'
                    },
                    body: JSON.stringify(data),
                    mode: 'no-cors',
                    credentials: 'omit',
                    referrer: window.location.href,
                    referrerPolicy: 'strict-origin-when-cross-origin'
                });
                console.log(response)
                // if (!response.ok) {
                //     throw new Error(`HTTP error! status: ${response.status}`);
                // }

                // const result = await response.json();
                return response;
            } catch (error) {
                console.error('Fetch error:', error);
                // é™é»˜å¤„ç†é”™è¯¯ï¼Œä¸å½±å“æ¸¸æˆè¿è¡Œ
                return null;
            }
        }

        function statClick(btnName, curScore) {
            function getCookie(name) {
                let cookieArr = document.cookie.split(";");
                for (let i = 0; i < cookieArr.length; i++) {
                    let cookiePair = cookieArr[i].trim();
                    if (cookiePair.startsWith(name + "=")) {
                        return decodeURIComponent(cookiePair.substring(name.length + 1));
                    }
                }
                return null;
            }

            // æ•°æ®ç»Ÿè®¡
            // let common_data = getCookie('common_data');

            // fetchData(url, data);
        }


        function log(...message) {
            if (isDebug) {
                console.log([new Date().toISOString(), ...message]);
            }
        }

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const currentScoreElement = document.getElementById('currentScore');
        const highScoreElement = document.getElementById('highScore');
        const startButton = document.getElementById('startButton');
        const pauseOverlay = document.getElementById('pauseOverlay');

        const gridSize = 20;
        const tileCount = canvas.width / gridSize;

        let snake = [
            { x: 10, y: 10 }
        ];
        let food = { x: 5, y: 5 };
        let dx = 0;
        let dy = 0;
        let score = 0;
        let highScore = 0;
        let gameInterval;
        let initGameSpeed = 120;
        let gameSpeed = initGameSpeed;
        let isPaused = false;
        let isGameRunning = false;
        let isGameOver = false;
        let flashInterval;
        let flashCount = 0;
        let hasMoved = false; // æ·»åŠ æ ‡å¿—ä½ï¼Œç”¨äºè·Ÿè¸ªè›‡æ˜¯å¦å·²ç»ç§»åŠ¨äº†ä¸€ä¸ªæ ¼å­
        const MAX_FLASH_COUNT = 6; // é—ªçƒæ¬¡æ•°

        // éŸ³æ•ˆç›¸å…³å˜é‡
        const eatSound = document.getElementById('eatSound');
        const gameOverSound = document.getElementById('gameOverSound');
        const soundToggle = document.getElementById('soundToggle');
        let isSoundEnabled = true;

        // æ’­æ”¾éŸ³æ•ˆçš„å‡½æ•°
        function playSound(sound) {
            if (sound && isSoundEnabled) {
                sound.currentTime = 0; // é‡ç½®éŸ³é¢‘åˆ°å¼€å§‹
                sound.play().catch(error => {
                    console.log('æ’­æ”¾éŸ³æ•ˆå¤±è´¥:', error);
                });
            }
        }

        // åˆ‡æ¢éŸ³æ•ˆå¼€å…³
        soundToggle.addEventListener('click', () => {
            isSoundEnabled = !isSoundEnabled;
            if (isSoundEnabled) {
                soundToggle.textContent = 'éŸ³æ•ˆ: å¼€';
                soundToggle.classList.remove('off');
                soundToggle.classList.add('on');
            } else {
                soundToggle.textContent = 'éŸ³æ•ˆ: å…³';
                soundToggle.classList.remove('on');
                soundToggle.classList.add('off');
            }
        });

        // æ›´æ–°æŒ‰é’®æ–‡å­—
        function updateButtonText(isGameOver = false, isGameRunning = false) {
            if (isGameOver) {
                startButton.textContent = 'é‡æ–°å¼€å§‹';
            } else if (isGameRunning) {
                startButton.textContent = 'æ¸¸æˆä¸­';
            } else {
                startButton.textContent = 'å¼€å§‹æ¸¸æˆ';
            }
        }

        // è·å–æœ€é«˜åˆ†
        function getHighScore() {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'snakeHighScore') {
                    return parseInt(value) || 0;
                }
            }
            return 0;
        }

        // ä¿å­˜æœ€é«˜åˆ†
        function saveHighScore(score) {
            // è·å–å½“å‰åŸŸå
            const domain = window.location.hostname;
            // å¦‚æœæ˜¯IPåœ°å€ï¼Œç›´æ¥ä½¿ç”¨å½“å‰åŸŸå
            // å¦åˆ™æå–é¡¶çº§åŸŸåï¼ˆå¦‚ï¼šä» www.example.com æå– .example.comï¼‰
            const cookieDomain = domain.match(/^\d+\.\d+\.\d+\.\d+$/) ? domain : '.' + domain.split('.').slice(-2).join('.');

            document.cookie = `snakeHighScore=${score}; path=/; domain=${cookieDomain}; max-age=31536000`; // ä¿å­˜1å¹´
        }

        // åˆå§‹åŒ–æœ€é«˜åˆ†
        highScore = getHighScore();
        highScoreElement.textContent = `æœ€é«˜åˆ†æ•°: ${highScore}`;

        function drawSnakeEyes(head) {
            const eyeSize = gridSize / 10 * 2; // çœ¼ç›å¤§å°

            // è®¡ç®—çœ¼ç›çš„åŸºå‡†ä½ç½®ï¼ˆè›‡å¤´ä¸­å¿ƒï¼‰
            const centerX = head.x * gridSize + gridSize / 2;
            const centerY = head.y * gridSize + gridSize / 2;
            const eyeWidth = eyeSize * 2;

            // æ ¹æ®ç§»åŠ¨æ–¹å‘ç¡®å®šçœ¼ç›ä½ç½®
            let leftEyeX, leftEyeY, rightEyeX, rightEyeY;

            if (dx === 1) { // å‘å³ç§»åŠ¨
                leftEyeX = centerX;
                rightEyeX = centerX;
                leftEyeY = centerY - eyeWidth;
                rightEyeY = centerY;
            } else if (dx === -1) { // å‘å·¦ç§»åŠ¨
                leftEyeX = centerX - eyeWidth;
                rightEyeX = centerX - eyeWidth;
                leftEyeY = centerY - eyeWidth;
                rightEyeY = centerY;
            } else if (dy === 1) { // å‘ä¸‹ç§»åŠ¨
                leftEyeX = centerX - eyeWidth;
                rightEyeX = centerX;
                leftEyeY = centerY;
                rightEyeY = centerY;
            } else { // å‘ä¸Šç§»åŠ¨
                leftEyeX = centerX - eyeWidth;
                rightEyeX = centerX;
                leftEyeY = centerY - eyeWidth;
                rightEyeY = centerY - eyeWidth;
            }

            // ç»˜åˆ¶çœ¼ç›ï¼ˆæ­£æ–¹å½¢ï¼‰
            ctx.fillStyle = 'black';
            ctx.fillRect(leftEyeX, leftEyeY, eyeSize, eyeSize);
            ctx.fillRect(rightEyeX, rightEyeY, eyeSize, eyeSize);
        }

        // ç»˜åˆ¶å¸¦è¾¹æ¡†å’Œå†…éƒ¨å°æ­£æ–¹å½¢çš„æ–¹å—
        function drawSquare(x, y, size, bgColor, borderColor, innerColor) {
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = bgColor;
            ctx.fillRect(x, y, size, size);

            // ç»˜åˆ¶è¾¹æ¡†
            ctx.strokeStyle = borderColor;
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y, size, size);

            // ç»˜åˆ¶å†…éƒ¨å°æ­£æ–¹å½¢
            const innerSize = size * 0.6;
            const offset = (size - innerSize) / 2;
            ctx.fillStyle = innerColor;
            ctx.fillRect(x + offset, y + offset, innerSize, innerSize);
        }

        // ç»˜åˆ¶è›‡å¤´
        function drawSnakeHead(head) {
            const size = gridSize - 4;
            drawSquare(
                head.x * gridSize,
                head.y * gridSize,
                size,
                'white',
                'black',
                'white'
            );

            drawSnakeEyes(head);
        }

        // ç»˜åˆ¶è›‡èº«
        function drawSnakeBody(segment) {
            const size = gridSize - 4;
            drawSquare(
                segment.x * gridSize,
                segment.y * gridSize,
                size,
                'white',
                'black',
                'black'
            );
        }

        function drawGame() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶é£Ÿç‰©
            const size = gridSize - 4;
            drawSquare(
                food.x * gridSize,
                food.y * gridSize,
                size,
                'white',
                'black',
                'black'
            );

            // ç»˜åˆ¶è›‡
            if (isGameOver) {
                // æ¸¸æˆç»“æŸæ—¶ï¼Œæ ¹æ®é—ªçƒçŠ¶æ€æ”¹å˜è›‡çš„é¢œè‰²
                if (flashCount % 2 === 0) {
                    // ç»˜åˆ¶è›‡å¤´
                    drawSnakeHead(snake[0]);

                    // ç»˜åˆ¶è›‡èº«
                    for (let i = 1; i < snake.length; i++) {
                        drawSnakeBody(snake[i]);
                    }
                } else {
                    // é—ªçƒæ—¶å…¨éƒ¨ä½¿ç”¨ç°è‰²
                    snake.forEach(segment => {
                        const size = gridSize - 4;
                        drawSquare(
                            segment.x * gridSize,
                            segment.y * gridSize,
                            size,
                            'gray',
                            'black',
                            'black'
                        );
                    });
                }
            } else {
                // æ­£å¸¸çŠ¶æ€ä¸‹
                // ç»˜åˆ¶è›‡å¤´
                drawSnakeHead(snake[0]);

                // ç»˜åˆ¶è›‡èº«
                for (let i = 1; i < snake.length; i++) {
                    drawSnakeBody(snake[i]);
                }
            }
        }

        function moveSnake() {
            // å¦‚æœè›‡æ²¡æœ‰ç§»åŠ¨ï¼Œä¸æ‰§è¡Œç§»åŠ¨
            if (dx === 0 && dy === 0) {
                return;
            }

            const head = { x: snake[0].x + dx, y: snake[0].y + dy };
            snake.unshift(head);

            // æ£€æŸ¥æ˜¯å¦åƒåˆ°é£Ÿç‰©
            if (head.x === food.x && head.y === food.y) {
                playSound(eatSound); // æ’­æ”¾åƒåˆ°é£Ÿç‰©çš„éŸ³æ•ˆ
                score += 10;
                currentScoreElement.textContent = `å½“å‰åˆ†æ•°: ${score}`;
                generateFood();
                // åŠ å¿«æ¸¸æˆé€Ÿåº¦
                // å¦‚æœé£Ÿç‰©ä¸åœ¨è¾¹ç¼˜ï¼Œåˆ™åŠ å¿«æ¸¸æˆé€Ÿåº¦
                // å¦‚æœåˆ†æ•°æ˜¯100çš„å€æ•°ï¼Œåˆ™åŠ å¿«æ¸¸æˆé€Ÿåº¦
                if (gameSpeed > 80 && score % 100 == 0 && (food.x != 0 && food.y != 0 && food.x != tileCount - 1 && food.y != tileCount - 1)) {
                    gameSpeed -= 2;
                    clearInterval(gameInterval);
                    gameInterval = setInterval(gameLoop, gameSpeed);
                }
            } else {
                snake.pop();
            }

            hasMoved = true; // æ ‡è®°è›‡å·²ç»ç§»åŠ¨äº†ä¸€ä¸ªæ ¼å­
        }

        function generateFood() {
            food.x = Math.floor(Math.random() * tileCount);
            food.y = Math.floor(Math.random() * tileCount);

            // ç¡®ä¿é£Ÿç‰©ä¸ä¼šç”Ÿæˆåœ¨è›‡èº«ä¸Š
            while (snake.some(segment => segment.x === food.x && segment.y === food.y)) {
                food.x = Math.floor(Math.random() * tileCount);
                food.y = Math.floor(Math.random() * tileCount);
            }
        }

        function checkCollision() {
            // å¦‚æœè›‡æ²¡æœ‰ç§»åŠ¨ï¼Œä¸æ£€æµ‹ç¢°æ’
            if (dx === 0 && dy === 0) {
                return false;
            }

            const head = snake[0];
            const nextX = head.x + dx;
            const nextY = head.y + dy;

            // æ£€æŸ¥æ˜¯å¦æ’å¢™
            if (nextX < 0 || nextX >= tileCount || nextY < 0 || nextY >= tileCount) {
                return true;
            }

            // æ£€æŸ¥æ˜¯å¦æ’åˆ°è‡ªå·±
            // ä»ç¬¬å››ä¸ªèŠ‚ç‚¹å¼€å§‹æ£€æŸ¥ï¼Œå› ä¸ºï¼š
            // 1. ç¬¬ä¸€ä¸ªæ˜¯å¤´éƒ¨
            // 2. ç¬¬äºŒä¸ªæ˜¯å³å°†æˆä¸ºèº«ä½“çš„éƒ¨åˆ†
            // 3. ç¬¬ä¸‰ä¸ªæ˜¯å½“å‰èº«ä½“çš„ç¬¬ä¸€éƒ¨åˆ†
            // 4. ç¬¬å››ä¸ªåŠä»¥åæ‰æ˜¯å¯èƒ½å‘ç”Ÿç¢°æ’çš„éƒ¨åˆ†
            for (let i = 3; i < snake.length; i++) {
                if (nextX === snake[i].x && nextY === snake[i].y) {
                    return true;
                }
            }

            return false;
        }

        function togglePause() {
            if (!isGameRunning) return;

            isPaused = !isPaused;
            if (isPaused) {
                clearInterval(gameInterval);
                pauseOverlay.style.display = 'flex';
            } else {
                gameInterval = setInterval(gameLoop, gameSpeed);
                pauseOverlay.style.display = 'none';
            }
        }

        function startFlashAnimation() {
            statClick('snake_game_click_game_over', score)
            playSound(gameOverSound); // æ’­æ”¾æ¸¸æˆç»“æŸéŸ³æ•ˆ
            isGameOver = true;
            flashCount = 0;
            flashInterval = setInterval(() => {
                flashCount++;
                drawGame();
                if (flashCount >= MAX_FLASH_COUNT) {
                    clearInterval(flashInterval);
                    showGameOverMessage();
                }
            }, 200); // æ¯200æ¯«ç§’é—ªçƒä¸€æ¬¡
        }

        function showGameOverMessage() {
            isGameOver = false;
            // æ£€æŸ¥æ˜¯å¦æ‰“ç ´æœ€é«˜åˆ†
            if (score > highScore) {
                highScore = score;
                saveHighScore(highScore);
                highScoreElement.textContent = `æœ€é«˜åˆ†æ•°: ${highScore}`;

                const messages = [
                    "å¤ªæ£’äº†ï¼ä½ åˆ›é€ äº†æ–°çš„è®°å½•ï¼ğŸ‰",
                    "å“‡ï¼ä½ çœŸæ˜¯å¤ªå‰å®³äº†ï¼ç»§ç»­æŒ‘æˆ˜æ›´é«˜çš„åˆ†æ•°å§ï¼",
                    "æ–°çºªå½•è¯ç”Ÿï¼ä½ æ˜¯æœ€æ£’çš„ï¼è¿˜èƒ½å†åˆ›æ–°é«˜å—ï¼Ÿ",
                    "æ­å–œä½ æ‰“ç ´è®°å½•ï¼è®©æˆ‘ä»¬çœ‹çœ‹ä½ èƒ½èµ°å¤šè¿œï¼",
                    "å¤ªä¸å¯æ€è®®äº†ï¼ä½ è¶…è¶Šäº†è‡ªæˆ‘ï¼ç»§ç»­åŠ æ²¹ï¼"
                ];
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                alert(`æ¸¸æˆç»“æŸï¼\n\n${randomMessage}\n\nä½ çš„å¾—åˆ†æ˜¯: ${score}\næ–°çš„æœ€é«˜åˆ†: ${highScore}`);
            } else {
                const messages = [
                    "å·®ä¸€ç‚¹å°±æ‰“ç ´è®°å½•äº†ï¼å†è¯•ä¸€æ¬¡å§ï¼",
                    "ç»§ç»­åŠªåŠ›ï¼Œä½ ä¸€å®šèƒ½åˆ›é€ æ–°çºªå½•ï¼",
                    "å·²ç»å¾ˆæ¥è¿‘æœ€é«˜åˆ†äº†ï¼ŒåŠ æ²¹ï¼",
                    "å°±å·®é‚£ä¹ˆä¸€ç‚¹ç‚¹äº†ï¼Œå†æŒ‘æˆ˜ä¸€æ¬¡å§ï¼",
                    "ä½ çš„æ½œåŠ›æ— é™ï¼Œç»§ç»­æŒ‘æˆ˜å§ï¼"
                ];
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                alert(`æ¸¸æˆç»“æŸï¼\n\n${randomMessage}\n\nä½ çš„å¾—åˆ†æ˜¯: ${score}\næœ€é«˜åˆ†: ${highScore}`);
            }
            resetGame();
            updateButtonText(true, false);
        }

        function gameLoop() {
            if (isPaused) return;
            if (checkCollision()) {
                clearInterval(gameInterval);
                isGameRunning = false;
                startFlashAnimation();
                return;
            }
            moveSnake();
            drawGame();
        }

        function resetGame() {
            clearInterval(gameInterval);
            snake = [{ x: 10, y: 10 }];
            dx = 0;
            dy = 0;
            score = 0;
            currentScoreElement.textContent = `å½“å‰åˆ†æ•°: ${score}`;
            gameSpeed = initGameSpeed;
            generateFood();
            isPaused = false;
            isGameOver = false;
            pauseOverlay.style.display = 'none';
            hasMoved = true; // æ¸¸æˆå¼€å§‹æ—¶è®¾ç½®hasMovedä¸ºtrueï¼Œè®©è›‡å¯ä»¥å¼€å§‹ç§»åŠ¨
            if (flashInterval) {
                clearInterval(flashInterval);
            }
            updateButtonText(isGameOver, isGameRunning);
        }

        document.addEventListener('keydown', (event) => {
            if (isGameRunning) {
                let stopKeys = ['w', 's', 'a', 'd', 'arrowup', 'arrowdown', 'arrowleft', 'arrowright', ' ']
                log('event.key.toLowerCase() = ', event.key.toLowerCase())
                if (stopKeys.includes(event.key.toLowerCase())) {
                    event.preventDefault();
                    event.stopPropagation();
                }
            }

            // å¤„ç†ç©ºæ ¼é”®
            if (event.key.toLowerCase() === ' ') {
                if (isGameRunning) {
                    event.preventDefault();
                    event.stopPropagation();
                    togglePause();
                }
                return;
            }

            // å¦‚æœæ¸¸æˆæš‚åœæˆ–æœªå¼€å§‹ï¼Œä¸å¤„ç†æ–¹å‘é”®
            if (isPaused || !isGameRunning) {
                return;
            }

            // å¦‚æœè›‡è¿˜æ²¡æœ‰ç§»åŠ¨ä¸€ä¸ªæ ¼å­ï¼Œä¸å¤„ç†æ–°çš„æ–¹å‘é”®
            if (!hasMoved) {
                return;
            }

            // è·å–å½“å‰ç§»åŠ¨æ–¹å‘
            const currentDx = dx;
            const currentDy = dy;
            let newDx = dx;
            let newDy = dy;

            // å¤„ç†æ–¹å‘é”®
            switch (event.key.toLowerCase()) {
                case 'w':
                case 'arrowup':
                    if (dy !== 1) {
                        newDx = 0;
                        newDy = -1;
                    }
                    break;
                case 's':
                case 'arrowdown':
                    if (dy !== -1) {
                        newDx = 0;
                        newDy = 1;
                    }
                    break;
                case 'a':
                case 'arrowleft':
                    if (dx !== 1) {
                        newDx = -1;
                        newDy = 0;
                    }
                    break;
                case 'd':
                case 'arrowright':
                    if (dx !== -1) {
                        newDx = 1;
                        newDy = 0;
                    }
                    break;
            }

            // åªæœ‰åœ¨æ–¹å‘çœŸæ­£æ”¹å˜æ—¶æ‰æ›´æ–°æ–¹å‘
            if (newDx !== dx || newDy !== dy) {
                dx = newDx;
                dy = newDy;
                hasMoved = false; // é‡ç½®ç§»åŠ¨æ ‡å¿—
            }
        });

        startButton.addEventListener('click', (e) => {
            statClick('snake_game_click_start', score)
            // ç¡®ä¿åªæœ‰é¼ æ ‡ç‚¹å‡»æ‰ä¼šè§¦å‘
            if (e.type === 'click' && e.detail === 1) {
                log('startButton click e = ', e);
                if (isGameRunning) {
                    if (isPaused) {
                        if (confirm('æ¸¸æˆå·²æš‚åœï¼Œæ˜¯å¦é‡æ–°å¼€å§‹ï¼Ÿ')) {
                            clearInterval(gameInterval);
                            isGameRunning = false;
                            resetGame();
                            isGameRunning = true;
                            gameInterval = setInterval(gameLoop, gameSpeed);
                            updateButtonText(isGameOver, isGameRunning);
                        }
                    } else {
                        if (confirm('æ¸¸æˆæ­£åœ¨è¿›è¡Œä¸­ï¼Œæ˜¯å¦é‡æ–°å¼€å§‹ï¼Ÿ')) {
                            clearInterval(gameInterval);
                            resetGame();
                            isGameRunning = true;
                            gameInterval = setInterval(gameLoop, gameSpeed);
                            updateButtonText(isGameOver, isGameRunning);
                        }
                    }
                } else {
                    resetGame();
                    isGameRunning = true;
                    gameInterval = setInterval(gameLoop, gameSpeed);
                    updateButtonText(isGameOver, isGameRunning);
                }
            }
        });
    </script>
</body>

</html>